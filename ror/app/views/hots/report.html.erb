<title>热点事件</title>
<!-- BEGIN PAGE -->
<div class="page-content">
	<!-- BEGIN PAGE CONTAINER-->
	<div class="container-fluid">
		<!-- BEGIN PAGE HEADER-->
		<div class="row-fluid">
			<div class="span12"> 	
				<!-- BEGIN PAGE TITLE & BREADCRUMB-->			
				<h3 class="page-title">
					<span class="main_title" id="hot">热点事件</span>
					<small>跟踪查询事件整个过程</small>
				</h3>
				<ul class="breadcrumb">
					<li>
						<i class="icon-home"></i>
						<a href="/hots/index">热点事件</a> 
						<i class="icon-angle-right"></i>
					</li>
					<li><a href="#">事件报表</a>(<a href="/hots/show/<%= @hot.id %>">查看具体信息列表</a>) 时间：<%= hot_time %></li>
					<li class="pull-right no-text-shadow">
		            <div id="filter" class="filter">
		              时间：<input type="text" id="startTime" readonly="">
		              至 <input type="text" id="endTime" readonly=""> 
		             
		              <button id="conditionSearch" class="gray-btn add-btn ok_btn">应用</button>
		            </div>      
		          </li>
				</ul>
				<!-- END PAGE TITLE & BREADCRUMB-->
			</div>
		</div>
		<!-- END PAGE HEADER-->
		<!-- BEGIN PAGE CONTENT-->		
	
			<div class="row-fluid">
				<div class="span12">
					<!-- BEGIN PORTLET-->
					<div class="portlet solid bordered light-grey">
						<div class="portlet-title">
							<h4><i class="icon-bar-chart"></i>舆情信息总数量</h4>
							<div class="tools">
								<div class="btn-group pull-right" data-toggle="buttons-radio">
									<a href="javascript:;" class="btn mini">舆情信息总数量</a>
									<a href="javascript:;" class="btn mini active">负面消息总数量</a>
								</div>
							</div>
						</div>
						<div class="portlet-body">
							<div id="site_statistics_loading1">
								<img src="/assets/img/loading.gif" alt="loading" />
							</div>
							<div id="site_statistics_content1" class="hide">
								<div id="maincontent1" class="chart"></div>
							</div>
						</div>
					</div>
					<!-- END PORTLET-->
				</div>
			</div>

			<div class="row-fluid">
				<div class="span12">
					<!-- BEGIN PORTLET-->
					<div class="portlet solid bordered light-grey">
						<div class="portlet-title">
							<h4><i class="icon-bar-chart"></i>微博信息总数量</h4>
							<div class="tools">
								<div class="btn-group pull-right" data-toggle="buttons-radio">
									<a href="javascript:;" class="btn mini">微博信息总数量</a>
									<a href="javascript:;" class="btn mini active">负面微博总数量</a>
								</div>
							</div>
						</div>
						<div class="portlet-body">
							<div id="site_statistics_loading2">
								<img src="/assets/img/loading.gif" alt="loading" />
							</div>
							<div id="site_statistics_content2" class="hide">
								<div id="maincontent2" class="chart"></div>
							</div>
						</div>
					</div>
					<!-- END PORTLET-->
				</div>
			</div>

			<div class="row-fluid">
				<div class="span4">
					<div class="portlet">
						<div class="portlet-title">
							<h4><i class="icon-reorder"></i>舆情情感比例</h4>
							<div class="tools">
								<a href="javascript:;" class="reload"></a>
							</div>
						</div>
						<div class="portlet-body">
							<div id="maincontent3" class="pie"></div>
						</div>
					</div>
				</div>


				<div class="span4">
					<div class="portlet">
						<div class="portlet-title">
							<h4><i class="icon-reorder"></i>微博情感比例</h4>
							<div class="tools">
								<a href="javascript:;" class="reload"></a>
							</div>
						</div>
						<div class="portlet-body">
							<div id="maincontent4" class="pie"></div>
						</div>
					</div>
				</div>

				<div class="span4">
					<div class="portlet">
						<div class="portlet-title">
							<h4><i class="icon-reorder"></i>用户性别比例</h4>
							<div class="tools">
								<a href="javascript:;" class="reload"></a>
							</div>
						</div>
						<div class="portlet-body">
							<div id="maincontent5" class="pie"></div>
						</div>
					</div>
				</div>

				
				

			</div>



			<div class="row-fluid">
				<div class="span4">
					<div class="portlet">
						<div class="portlet-title">
							<h4><i class="icon-reorder"></i>认证用户比例</h4>
							<div class="tools">
								<a href="javascript:;" class="reload"></a>
							</div>
						</div>
						<div class="portlet-body">
							<div id="maincontent7" class="pie"></div>
						</div>
					</div>
				</div>

				<div class="span4">
					<div class="portlet">
						<div class="portlet-title">
							<h4><i class="icon-reorder"></i>认证用户信息情感比例</h4>
							<div class="tools">
								<a href="javascript:;" class="reload"></a>
							</div>
						</div>
						<div class="portlet-body">
							<div id="maincontent8" class="pie"></div>
						</div>
					</div>
				</div>
				<div class="span4">
					<div class="portlet">
						<div class="portlet-title">
							<h4><i class="icon-reorder"></i>粉丝数分布</h4>
							<div class="tools">
								<a href="javascript:;" class="reload"></a>
							</div>
						</div>
						<div class="portlet-body">
							<div id="maincontent6" class="bar"></div>
						</div>
					</div>
				</div>

			</div>

			<div class="row-fluid">
				<div class="span3">
					<!-- BEGIN REGIONAL STATS PORTLET-->
					<div class="portlet">
						<div class="portlet-title">
							<h4><i class="icon-globe"></i>信息整体地理位置分布</h4>
							<div class="tools">
								<a href="javascript:;" class="reload"></a>
							</div>
						</div>
						<div class="portlet-body">										
							<div id="vmap_china1" style="background: white; width: 234px; height: 170px; margin-top:30px;"></div>
						</div>
					</div>
					<!-- END REGIONAL STATS PORTLET-->
				</div>

				<div class="span3">
					<!-- BEGIN REGIONAL STATS PORTLET-->
					<div class="portlet">
						<div class="portlet-title">
							<h4><i class="icon-globe"></i>正面信息地理分布</h4>
							<div class="tools">
								<a href="javascript:;" class="reload"></a>
							</div>
						</div>
						<div class="portlet-body">										
							<div id="vmap_china2" style="background: white; width: 234px; height: 170px; margin-top:30px;"></div>
						</div>
					</div>
					<!-- END REGIONAL STATS PORTLET-->
				</div>

				<div class="span3">
					<!-- BEGIN REGIONAL STATS PORTLET-->
					<div class="portlet">
						<div class="portlet-title">
							<h4><i class="icon-globe"></i>负面信息地理分布</h4>
							<div class="tools">
								<a href="javascript:;" class="reload"></a>
							</div>
						</div>
						<div class="portlet-body">										
							<div id="vmap_china3" style="background: white; width: 234px; height: 170px; margin-top:30px;"></div>
						</div>
					</div>
					<!-- END REGIONAL STATS PORTLET-->
				</div>

				<div class="span3">
					<!-- BEGIN REGIONAL STATS PORTLET-->
					<div class="portlet">
						<div class="portlet-title">
							<h4><i class="icon-globe"></i>中性信息地理分布</h4>
							<div class="tools">
								<a href="javascript:;" class="reload"></a>
							</div>
						</div>
						<div class="portlet-body">										
							<div id="vmap_china4" style="background: white; width: 234px; height: 170px; margin-top:30px;"></div>
						</div>
					</div>
					<!-- END REGIONAL STATS PORTLET-->
				</div>

			</div>


		<!-- END PAGE CONTENT-->
	</div>
	<!-- END PAGE CONTAINER-->		
</div>
<!-- END PAGE -->
</div>
<!-- END CONTAINER -->

<script>
$(function() {


	$('#site_statistics_loading1').hide();
    $('#site_statistics_content1').show();
    
    $('#maincontent1').highcharts({
        chart: {
            type: 'line',
            marginRight: 20,
            marginBottom: 40
        },
        title: {
            text: '  ',
            x: 0//center
        },
        xAxis: {
            categories: [<%= raw myxAxis1 %>],
            tickInterval : 5
        },
        yAxis: {
            title: {
                text: ''
            },
            min: 0
        },
        tooltip: {
            valueSuffix: ''
        },
	    legend: {
	            align: 'center',
	            verticalAlign: 'top',
	            y: 10,
	            floating: true,
	            borderWidth: 0
	    },
        series: [{
            name: '总体信息',
            color:'#2f7ed8',
            data: [<%= total_num_each_day %>] //total_num_each_day
        }, {
            name: '负面信息',
            color:'#910000',
            data: [<%= total_num_each_day_negative %>] //total_num_each_day_negative
        }]
    });

    $('#site_statistics_loading2').hide();
    $('#site_statistics_content2').show();
    $('#maincontent2').highcharts({
        chart: {
            type: 'line',
            marginRight: 20,
            marginBottom: 40
        },
        title: {
            text: '  ',
            x: 0//center
        },
        xAxis: {
            categories: [<%= raw myxAxis1 %>],
            tickInterval : 5
        },
        yAxis: {
            title: {
                text: ''
            },
            min: 0
        },
        tooltip: {
            valueSuffix: ''
        },
	    legend: {
	            align: 'center',
	            verticalAlign: 'top',
	            y: 10,
	            floating: true,
	            borderWidth: 0
	    },
        series: [{
            name: '总体信息',
            color:'#2f7ed8',
            data: [<%= total_num_each_day_weibo %>]//total_num_each_day_weibo
        }, {
            name: '负面信息',
            color:'#910000',
            data: [<%= total_num_each_day_negative_weibo %>]//total_num_each_day_negative_weibo
        }]
    });

    var handleChartGraphs1 = function () {

        var graphData = [];
        var s_array=['正面','中性','负面'];
        var v_array=[<%= total_sentiment_array[0] %>,<%= total_sentiment_array[2] %>,<%= total_sentiment_array[1] %>];
        var series = 3;
        for (var i = 0; i < series; i++) {
            graphData[i] = {
                label: s_array[i],
                data: v_array[i]
            }
        }

        $.plot($("#maincontent3"), graphData, {
            series: {
                pie: {
                    show: true,
                    radius: 1,
                    label: {
                        show: true,
                        radius: 1,
                        formatter: function (label, series) {
                            return '<div style="font-size:8pt;text-align:center;padding:2px;color:white;">' + label + '<br/>' +  parseFloat(series.percent).toFixed(1) + '%</div>';
                        },
                        background: {
                            opacity: 0.8
                        }
                    }
                }
            },
            grid: {
                hoverable: true,
                clickable: true
            }
        });

        function pieHover(event, pos, obj) {
            if (!obj) return;
            percent = parseFloat(obj.series.percent).toFixed(3);
            $("#hover").html('<span style="font-weight: bold; color: ' + obj.series.color + '">' + obj.series.label + ' (' + percent + '%)</span>');
        }

        function pieClick(event, pos, obj) {
            if (!obj) return;
            percent = parseFloat(obj.series.percent).toFixed(3);
            alert('' + obj.series.label + ': ' + percent + '%');
        }
	        
    }

    handleChartGraphs1();

    var handleChartGraphs2 = function () {

        var graphData = [];
        var s_array=['正面','中性','负面'];
        var v_array=[<%= total_sentiment_weibo_array[0] %>,<%= total_sentiment_weibo_array[2] %>,<%= total_sentiment_weibo_array[1] %>];
        var series = 3;
        for (var i = 0; i < series; i++) {
            graphData[i] = {
                label: s_array[i],
                data: v_array[i]
            }
        }

        $.plot($("#maincontent4"), graphData, {
            series: {
                pie: {
                    show: true,
                    radius: 1,
                    label: {
                        show: true,
                        radius: 1,
                        formatter: function (label, series) {
                            return '<div style="font-size:8pt;text-align:center;padding:2px;color:white;">' + label + '<br/>' +  parseFloat(series.percent).toFixed(1) + '%</div>';
                        },
                        background: {
                            opacity: 0.8
                        }
                    }
                }
            },
            grid: {
                hoverable: true,
                clickable: true
            }
        });

        function pieHover(event, pos, obj) {
            if (!obj) return;
            percent = parseFloat(obj.series.percent).toFixed(3);
            $("#hover").html('<span style="font-weight: bold; color: ' + obj.series.color + '">' + obj.series.label + ' (' + percent + '%)</span>');
        }

        function pieClick(event, pos, obj) {
            if (!obj) return;
            percent = parseFloat(obj.series.percent).toFixed(3);
            alert('' + obj.series.label + ': ' + percent + '%');
        }
	        
    }

    handleChartGraphs2();



    var handleChartGraphs3 = function () {

        var graphData = [];
        var s_array=['女性','男性'];
        var v_array=[<%= total_sex_weibo_array[0] %>,<%= total_sex_weibo_array[1] %>];
        var series = 3;
        for (var i = 0; i < series; i++) {
            graphData[i] = {
                label: s_array[i],
                data: v_array[i]
            }
        }

        $.plot($("#maincontent5"), graphData, {
            series: {
                pie: {
                    show: true,
                    radius: 0.9,
                    label: {
                        show: true,
                        radius: 1,
                        formatter: function (label, series) {
                            return '<div style="font-size:8pt;text-align:center;padding:2px;color:white;">' + label + '<br/>' +  parseFloat(series.percent).toFixed(1) + '%</div>';
                        },
                        background: {
                            opacity: 0.8
                        }
                    }
                }
            },
            grid: {
                hoverable: true,
                clickable: true
            }
        });

        function pieHover(event, pos, obj) {
            if (!obj) return;
            percent = parseFloat(obj.series.percent).toFixed(3);
            $("#hover").html('<span style="font-weight: bold; color: ' + obj.series.color + '">' + obj.series.label + ' (' + percent + '%)</span>');
        }

        function pieClick(event, pos, obj) {
            if (!obj) return;
            percent = parseFloat(obj.series.percent).toFixed(3);
            alert('' + obj.series.label + ': ' + percent + '%');
        }
	        
    }

    handleChartGraphs3();

    var handleChartGraphs5 = function () {

        var graphData = [];
        var s_array=['已认证','未认证'];
        var v_array=[<%= weibo_v_array[0] %>,<%= weibo_v_array[1] %>];
        var series = 3;
        for (var i = 0; i < series; i++) {
            graphData[i] = {
                label: s_array[i],
                data: v_array[i]
            }
        }

        $.plot($("#maincontent7"), graphData, {
            series: {
                pie: {
                    show: true,
                    radius: 0.9,
                    label: {
                        show: true,
                        radius: 1,
                        formatter: function (label, series) {
                            return '<div style="font-size:8pt;text-align:center;padding:2px;color:white;">' + label + '<br/>' +  parseFloat(series.percent).toFixed(1) + '%</div>';
                        },
                        background: {
                            opacity: 0.8
                        }
                    }
                }
            },
            grid: {
                hoverable: true,
                clickable: true
            }
        });

        function pieHover(event, pos, obj) {
            if (!obj) return;
            percent = parseFloat(obj.series.percent).toFixed(3);
            $("#hover").html('<span style="font-weight: bold; color: ' + obj.series.color + '">' + obj.series.label + ' (' + percent + '%)</span>');
        }

        function pieClick(event, pos, obj) {
            if (!obj) return;
            percent = parseFloat(obj.series.percent).toFixed(3);
            alert('' + obj.series.label + ': ' + percent + '%');
        }
	        
    }

    handleChartGraphs5();



    var handleChartGraphs6 = function () {

        var graphData = [];
        var s_array=['正面','中性','负面'];
        var v_array=[<%= weibo_v_array_sentiment[0] %>,<%= weibo_v_array_sentiment[2] %>,<%= weibo_v_array_sentiment[1] %>];
        var series = 3;
        for (var i = 0; i < series; i++) {
            graphData[i] = {
                label: s_array[i],
                data: v_array[i]
            }
        }

        $.plot($("#maincontent8"), graphData, {
            series: {
                pie: {
                    show: true,
                    radius: 1,
                    label: {
                        show: true,
                        radius: 1,
                        formatter: function (label, series) {
                            return '<div style="font-size:8pt;text-align:center;padding:2px;color:white;">' + label + '<br/>' +  parseFloat(series.percent).toFixed(1) + '%</div>';
                        },
                        background: {
                            opacity: 0.8
                        }
                    }
                }
            },
            grid: {
                hoverable: true,
                clickable: true
            }
        });

        function pieHover(event, pos, obj) {
            if (!obj) return;
            percent = parseFloat(obj.series.percent).toFixed(3);
            $("#hover").html('<span style="font-weight: bold; color: ' + obj.series.color + '">' + obj.series.label + ' (' + percent + '%)</span>');
        }

        function pieClick(event, pos, obj) {
            if (!obj) return;
            percent = parseFloat(obj.series.percent).toFixed(3);
            alert('' + obj.series.label + ': ' + percent + '%');
        }
	        
    }

    handleChartGraphs6();




    



    $('#maincontent6').highcharts({
            chart: {
                type: 'column',
                height: 180
            },
            title: {
                text: ''
            },
            xAxis: {
                categories: [
                    '0~49',
                    '50~99',
                    '100~199',
                    '200~499',
                    '500~999',
                    '1k~9999',
                    '1w~49999',
                    '>5w'
                ],tickInterval : 2

            },
            yAxis: {
                min: 0,
                title: {
                    text: '',
                }
            },
            tooltip: {
                headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                pointFormat: '<tr><td style="color:{series.color};padding:0"></td>' +
                    '<td style="padding:0"><b>用户数：{point.y}</b></td></tr>',
                footerFormat: '</table>',
                shared: true,
                useHTML: true
            },
            plotOptions: {
                column: {
                    pointPadding: 0.2,
                    borderWidth: 0
                },series: {
					showInLegend: false
				}
            },
            series: [{
                name: null,
                data: [<%= weibo_follows_array_str %>]
    
            }]
        });


	var handlethemap1 = function (){
		 //数据可以动态生成，格式自己定义，cha对应china-zh.js中省份的简称
		 
        var dataStatus = <%= total_region_num_str %>;
 
        $('#vmap_china1').vectorMap({ map: 'china_zh',
            color: "#B4B4B4", //地图颜色
            onLabelShow: function (event, label, code) {//动态显示内容
                $.each(dataStatus, function (i, items) {
                    if (code == items.cha) {
                        label.html(items.name + items.des);
                    }
                });
            }
        })
        
        
        
        $.each(dataStatus, function (i, items) {
            if (items.des.indexOf('条') != -1) {//动态设定颜色，此处用了自定义简单的判断
            	if(parseInt((items.des.substring(5,items.des.indexOf('条'))))<3){
                	var josnStr = "{" + items.cha + ":'#27a9e3'}";
            	}else if(parseInt((items.des.substring(5,items.des.indexOf('条'))))<6){
            		var josnStr = "{" + items.cha + ":'#1e92c6'}";
            	}else if(parseInt((items.des.substring(5,items.des.indexOf('条'))))<9){
            		var josnStr = "{" + items.cha + ":'#117dad'}";
            	}else{
            		var josnStr = "{" + items.cha + ":'#035e87'}";
            	}
                $('#vmap_china1').vectorMap('set', 'colors', eval('(' + josnStr + ')'));
            }
        });
        
	}




	var handlethemap2 = function (){
		 //数据可以动态生成，格式自己定义，cha对应china-zh.js中省份的简称
		 
        var dataStatus = <%= total_region_num_str_positive %>;
 
        $('#vmap_china2').vectorMap({ map: 'china_zh',
            color: "#B4B4B4", //地图颜色
            onLabelShow: function (event, label, code) {//动态显示内容
                $.each(dataStatus, function (i, items) {
                    if (code == items.cha) {
                        label.html(items.name + items.des);
                    }
                });
            }
        })
        
        
        
        $.each(dataStatus, function (i, items) {
            if (items.des.indexOf('条') != -1) {//动态设定颜色，此处用了自定义简单的判断
            	if(parseInt((items.des.substring(5,items.des.indexOf('条'))))<3){
                	var josnStr = "{" + items.cha + ":'#27a9e3'}";
            	}else if(parseInt((items.des.substring(5,items.des.indexOf('条'))))<6){
            		var josnStr = "{" + items.cha + ":'#1e92c6'}";
            	}else if(parseInt((items.des.substring(5,items.des.indexOf('条'))))<9){
            		var josnStr = "{" + items.cha + ":'#117dad'}";
            	}else{
            		var josnStr = "{" + items.cha + ":'#035e87'}";
            	}
                $('#vmap_china2').vectorMap('set', 'colors', eval('(' + josnStr + ')'));
            }
        });
        
	}

	var handlethemap3 = function (){
		 //数据可以动态生成，格式自己定义，cha对应china-zh.js中省份的简称
		 
        var dataStatus = <%= total_region_num_str_negative %>;
 
        $('#vmap_china3').vectorMap({ map: 'china_zh',
            color: "#B4B4B4", //地图颜色
            onLabelShow: function (event, label, code) {//动态显示内容
                $.each(dataStatus, function (i, items) {
                    if (code == items.cha) {
                        label.html(items.name + items.des);
                    }
                });
            }
        })
        
        
        
        $.each(dataStatus, function (i, items) {
            if (items.des.indexOf('条') != -1) {//动态设定颜色，此处用了自定义简单的判断
            	if(parseInt((items.des.substring(5,items.des.indexOf('条'))))<3){
                	var josnStr = "{" + items.cha + ":'#27a9e3'}";
            	}else if(parseInt((items.des.substring(5,items.des.indexOf('条'))))<6){
            		var josnStr = "{" + items.cha + ":'#1e92c6'}";
            	}else if(parseInt((items.des.substring(5,items.des.indexOf('条'))))<9){
            		var josnStr = "{" + items.cha + ":'#117dad'}";
            	}else{
            		var josnStr = "{" + items.cha + ":'#035e87'}";
            	}
                $('#vmap_china3').vectorMap('set', 'colors', eval('(' + josnStr + ')'));
            }
        });
        
	}

	var handlethemap4 = function (){
		 //数据可以动态生成，格式自己定义，cha对应china-zh.js中省份的简称
		 
        var dataStatus = <%= total_region_num_str_neutral %>;
 
        $('#vmap_china4').vectorMap({ map: 'china_zh',
            color: "#B4B4B4", //地图颜色
            onLabelShow: function (event, label, code) {//动态显示内容
                $.each(dataStatus, function (i, items) {
                    if (code == items.cha) {
                        label.html(items.name + items.des);
                    }
                });
            }
        })
        
        
        
        $.each(dataStatus, function (i, items) {
            if (items.des.indexOf('条') != -1) {//动态设定颜色，此处用了自定义简单的判断
            	if(parseInt((items.des.substring(5,items.des.indexOf('条'))))<3){
                	var josnStr = "{" + items.cha + ":'#27a9e3'}";
            	}else if(parseInt((items.des.substring(5,items.des.indexOf('条'))))<6){
            		var josnStr = "{" + items.cha + ":'#1e92c6'}";
            	}else if(parseInt((items.des.substring(5,items.des.indexOf('条'))))<9){
            		var josnStr = "{" + items.cha + ":'#117dad'}";
            	}else{
            		var josnStr = "{" + items.cha + ":'#035e87'}";
            	}
                $('#vmap_china4').vectorMap('set', 'colors', eval('(' + josnStr + ')'));
            }
        });
        
        $('.jvectormap-zoomin').click(); //放大
	}


	handlethemap1();

	handlethemap2();

	handlethemap3();

	handlethemap4();


	$(".ok_btn").live('click',function(){
	    var dStartTime = $('#startTime');
	    var dEndTime = $('#endTime');
	    var d1=dStartTime.val()+" "+"00:00:00";
	    var d2=dEndTime.val()+" "+"23:59:59";
	    order=$("#order").val();
	    emotion=$("#emotion").val();
	    start=new Date(d1).getTime();
	    end=new Date(d2).getTime();
	    //alert(order);
	    self.location="/hots/report/<%= @hot.id %>?starttime=" + start+"&endtime=" + end;
  	});


});
</script>



